#! /bin/bash

set -e

cd $SOURCE_DIR
curl -Ls $ARROW_TARBALL \
  | tar xzf -

cd $SOURCE_DIR/arrow-apache-arrow-*/cpp/
rm -fr build; mkdir build; cd build
cmake .. \
  -DPYTHON_EXECUTABLE=/usr/bin/python3 \
  -DARROW_BUILD_EXAMPLES=ON \
  -DARROW_BUILD_UTILITIES=ON \
  -DARROW_COMPUTE=ON \
  -DARROW_CSV=ON \
  -DARROW_CUDA=ON \
  -DARROW_DATASET=ON \
  -DARROW_FILESYSTEM=ON \
  -DARROW_FLIGHT=ON \
  -DARROW_GANDIVA=ON \
  -DARROW_HDFS=ON \
  -DARROW_IPC=ON \
  -DARROW_JSON=ON \
  -DARROW_PARQUET=ON \
  -DARROW_ORC=ON \
  -DARROW_PLASMA=ON \
  -DARROW_PYTHON=ON \
  -DARROW_TENSORFLOW=ON \
  -DARROW_WITH_BROTLI=ON \
  -DARROW_WITH_BZ2=ON \
  -DARROW_WITH_LZ4=ON \
  -DARROW_WITH_SNAPPY=ON \
  -DARROW_WITH_ZLIB=ON \
  -DARROW_WITH_ZSTD=ON \
  -DARROW_WITH_UTF8PROC=ON \
  -DPARQUET_BUILD_EXECUTABLES=ON \
  -DPARQUET_BUILD_EXAMPLES=ON
make -j`nproc` install

cd $SOURCE_DIR
rm -fr arrow-apache-arrow-*
