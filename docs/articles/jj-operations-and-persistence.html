<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Operations and Persistence • edgyR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/darkly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Operations and Persistence">
<meta property="og:description" content="edgyR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">edgyR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.9.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aa-setting-up-the-jetson-nano.html">Setting up the Jetson Nano</a>
    </li>
    <li>
      <a href="../articles/cc-l4t-first-steps.html">Linux for Tegra (L4T) First Steps</a>
    </li>
    <li>
      <a href="../articles/ee-running-an-edgyr-container.html">Running an `edgyR` Container</a>
    </li>
    <li>
      <a href="../articles/hh-software-on-the-image.html">Overview of Software on the Image</a>
    </li>
    <li>
      <a href="../articles/jj-operations-and-persistence.html">Operations and Persistence</a>
    </li>
    <li>
      <a href="../articles/kk-jupyter-lab.html">Using JupyterLab</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/znmeb/edgyR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="jj-operations-and-persistence_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Operations and Persistence</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/znmeb/edgyR/blob/master/vignettes/jj-operations-and-persistence.Rmd"><code>vignettes/jj-operations-and-persistence.Rmd</code></a></small>
      <div class="hidden name"><code>jj-operations-and-persistence.Rmd</code></div>

    </div>

    
    
<div id="docker-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#docker-operations" class="anchor"></a>Docker operations</h2>
<p>There are two user-visible components to a Docker package: an <code>image</code>, which is a collection of software, and <code>containers</code>, where the software runs. In this release there is a single image, <code>edgyr-ml</code>, and normally you will only be running a single container, called <code>edgyr</code>.</p>
<p>In the following, all operations will occur on the Docker host in the directory <code>edgyr/container-run-scripts</code>. I’m going to assume the host is a Jetson Nano called “Nano”.</p>
<div id="pulling-the-image" class="section level3">
<h3 class="hasAnchor">
<a href="#pulling-the-image" class="anchor"></a>Pulling the image</h3>
<p>Before you can use the image, you have to have it on your Docker host. To do this, run the script <code>pull-image</code>:</p>
<pre><code>znmeb@Nano:~/Projects/edgyR/container-run-scripts$ ./pull-image 
latest: Pulling from znmeb/edgyr-ml
3b5e2c02f523: Pulling fs layer 
b9448035bb0a: Pulling fs layer 

[snip]

464529f5c5bb: Pull complete 
248fad5e214b: Pull complete 
6de52330cbb9: Pull complete 
Digest: sha256:51265581fe03aae8fb6a2cbc28929a56b33229cf5656d04723ad5c9e78a121d0
Status: Downloaded newer image for znmeb/edgyr-ml:latest
docker.io/znmeb/edgyr-ml:latest
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
znmeb/edgyr-ml      latest              a74882eb113b        19 hours ago        6.84GB
znmeb@Nano:~/Projects/edgyR/container-run-scripts$ </code></pre>
</div>
<div id="running-the-image-in-a-container" class="section level3">
<h3 class="hasAnchor">
<a href="#running-the-image-in-a-container" class="anchor"></a>Running the image in a container</h3>
<p>Once we’ve pulled the image, we need to create a container with the image and start the service processes in it, in this case RStudio Server. We do this with the <code>run-edgyr</code> script:</p>
<pre><code>znmeb@Nano:~/Projects/edgyR/container-run-scripts$ export EDGYR_PASSWORD="12.angry%characters"
znmeb@Nano:~/Projects/edgyR/container-run-scripts$ ./run-edgyr 
Force-removing old 'edgyr' container
You can ignore errors if it doesn't exist
Error: No such container: edgyr
Running image znmeb/edgyr-ml:latest
867dcf8179966c9aa4472e8b0d71267106902a3da572b9ebb2e6bce5a3f2231d
CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS               NAMES
867dcf817996        znmeb/edgyr-ml:latest   "/docker-entrypoint.…"   13 seconds ago      Up 5 seconds                            edgyr
Resetting 'edgyr' password
Starting RStudio Server - browse to port 7878 on Docker host
znmeb@Nano:~/Projects/edgyR/container-run-scripts$ </code></pre>
<p>If you forget to define the <code>EDGYR_PASSWORD</code> variable, you’ll get an error message:</p>
<pre><code>znmeb@Nano:~/Projects/edgyR/container-run-scripts$ ./run-edgyr 
You need to specify a new password for the 'edgyr'
account in the 'EDGYR_PASSWORD' environment variable.
The new 'edgyr' password must be at least 12 characters!</code></pre>
<p>A Docker container is a collection of Linux processes that are isolated from the host except for well-defined resource usages and behavior. When you did <code>./run-edgyr</code>, the following things happened:</p>
<ol style="list-style-type: decimal">
<li>If there was already an <code>edgyr</code> container, Docker removed it.</li>
<li>Docker created a new container, called <code>edgyr</code>.</li>
<li>Docker set the filesystem of the container to the contents of the image, <code>docker.io/znmeb/edgyr-ml</code>. This filesystem is independent of the host filesystem; it’s stored in a protected area that Docker manages.</li>
<li>Docker connected the container’s network to the host network. This means any ports that the processes in the container uses are bound to the host port with the same numbers. For this image, that’s port <code>7878</code> for RStudio Server and port <code>8888</code> if you start up the JupyterLab service.</li>
<li>Docker started the container by running a script in the container called <code>docker-entrypoint.sh</code>.</li>
<li>
<code>docker-entrypoint.sh</code> read the <code>EDGYR_PASSWORD</code> environment variable and set the password for the <code>edgyr</code> account in the container to that value.</li>
</ol>
<p>All of this means you can now browse to port <code>7878</code> on the host Nano remotely, or to port <code>7878</code> on <code>localhost</code> from the Nano console, and log in to RStudio Server as <code>edgyr</code> with the password you set.</p>
<p>The host - container relationship is a bit like one-way mirrors. The processes in the container can only see other processes running in the container, can only read and write to filesystems we allow, which in this case is the filesystem we created from the image with <code>./run-edgyr</code>.</p>
<p>We haven’t restricted the container’s CPU, GPU or RAM usage, but we could have done so. And we have connected the container directly to the host network, but we could have created an isolated network that only the container and other containers we specified could use.</p>
</div>
<div id="stopping-and-restarting-the-container" class="section level3">
<h3 class="hasAnchor">
<a href="#stopping-and-restarting-the-container" class="anchor"></a>Stopping and restarting the container</h3>
<p>Suppose we want to stop the container but keep all the files on its filesystem intact. We do that by <em>stopping</em> the container. There’s a script for that:</p>
<pre><code>znmeb@Nano:~/Projects/edgyR/container-run-scripts$ ./stop-edgyr 
Stopping the 'edgyr' container
edgyr
CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS                       PORTS               NAMES
867dcf817996        znmeb/edgyr-ml:latest   "/docker-entrypoint.…"   3 hours ago         Exited (137) 5 seconds ago                       edgyr
znmeb@Nano:~/Projects/edgyR/container-run-scripts$ </code></pre>
<p>Now if you try to log in from a browser you’ll get an error message:</p>
<p>To start the container back up again, we <em>start</em> the container, and there’s a script for that too:</p>
<pre><code>znmeb@Nano:~/Projects/edgyR/container-run-scripts$ ./start-edgyr 
Starting the 'edgyr' container
edgyr
CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS               NAMES
867dcf817996        znmeb/edgyr-ml:latest   "/docker-entrypoint.…"   3 hours ago         Up 5 seconds                            edgyr
znmeb@Nano:~/Projects/edgyR/container-run-scripts$ </code></pre>
</div>
</div>
<div id="git-and-github" class="section level2">
<h2 class="hasAnchor">
<a href="#git-and-github" class="anchor"></a>Git and GitHub</h2>
<p>The primary goal of the <code>edgyR</code> project is to provide an R / RStudio package development environment for Jetson development kits. As a result, I strongly encourage developers to use Git and GitHub for persistence and collaboration rather than other means. The Nano is especially a one-person machine; it only has 4 GB of RAM and a small filesystem by current standards. See <span class="citation">(Wickham 2015)</span> for more practical advice on R package development.</p>
</div>
<div id="next-using-jupyterlab" class="section level2">
<h2 class="hasAnchor">
<a href="#next-using-jupyterlab" class="anchor"></a>Next: Using JupyterLab</h2>
<p><code><a href="../articles/kk-jupyter-lab.html">vignette("kk-jupyter-lab")</a></code></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Wickham2015r">
<p>Wickham, H. 2015. <em>R Packages: Organize, Test, Document, and Share Your Code</em>. O’Reilly Media. <a href="http://r-pkgs.had.co.nz/">http://r-pkgs.had.co.nz/</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by M. Edward (Ed) Borasky.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
